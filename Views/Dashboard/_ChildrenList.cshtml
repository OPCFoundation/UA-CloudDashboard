@using Microsoft.Azure.IoTSuite.Connectedfactory.WebApp.Contoso
@using Microsoft.Azure.IoTSuite.Connectedfactory.WebApp.Models
@using Microsoft.AspNetCore.Routing
@using OpcUaWebDashboard.Properties;

@model DashboardModel

<div class="dashboard_children_container_header row">
    <div id="backIcon" class="dashboard_children_back_icon col-xs-1 col-md-1 col-lg-1 " hidden>
        <a id="allIcon" class="dashboard_children_container_header_icon" align="left" href="#" onclick="gotoParentNode();">
            <img class="dashboard-chevron-left" src="/Content/img/chevron_left.svg">
        </a>
    </div>
    <p id="headerText" class="dashboard_children_container_header_text col-xs-8 col-md-8 col-lg-8 overflow">@Model.ChildrenContainerHeader</p>
    <a id="allIcon" class="dashboard_children_container_header_text_glyph" align="right" href="#" onclick="openFilterContextPanel();">
        <img id="dashboardChildrenContainerHeaderFilter" class="dashboard_filter_icon" src="/Content/img/filter.svg">
        @Resources.NoFilterApplied
    </a>
    <p id="filterIcon" class="dashboard_children_container_header_text_glyph" hidden>
        <a id="openFromFiltered" href="javascript:openFilterContextPanel();"><img id="dashboardChildrenContainerHeaderFilter" class="dashboard_container_filter" src="/Content/img/filter.svg"></a>
    </p>
</div>
<div class="dashboard_children_list_header row">
    @*<div class="dashboard_children_list_header_status col-xs-3 col-lg-3 overflow">@Model.ChildrenListHeaderStatus</div>*@
    <div class="dashboard_children_list_header_location col-xs-5 col-lg-5 overflow">@Model.ChildrenListHeaderLocation</div>
    <div class="dashboard_children_list_header_details col-xs-7 col-lg-7 overflow">@Model.ChildrenListHeaderDetails</div>
</div>
<div id="childrenListContainer" class="dashboard_children_list_container scrollbar-inner scroll_only_y row">
    <div id="dashboardChildrenList" class="col-xs-12">

        @{int subLabelTabCount = 0; }
        @for (int i = 0; i < Model.Children.Count; i++)
        {
            var child = Model.Children[i];
            var statusMessage = Resources.Normal;

            var dashboardLabelClass = "dashboard_children_label_container";
            var dashboardMarginClass = "dashboard_children_listitem_container_label";

            RouteValueDictionary valueDictionary = new RouteValueDictionary { { "topNode", child.Key } };
            var dashboardUrl = @Url.Action("Index", "Dashboard", valueDictionary);
            <div>
                @if (Model.ChildrenType == typeof(ContosoOpcUaNode))
                {
                    if (child.Visible == true)
                    {
                        if (child.GroupLabel != null)
                        {
                            if (child.GroupLabel == "Axis ")
                            {
                                int.TryParse(@child.GroupLabelLength, out subLabelTabCount);
                                dashboardLabelClass = "dashboard_children_sublabel_container";
                                subLabelTabCount--;
                            }
                            else
                            {
                                dashboardLabelClass = "dashboard_children_label_container";
                            }
                            <div id="dashboard_children_Label@(i)" class="@dashboardLabelClass ">
                                <a role="button" onclick="expand(@i, @child.GroupLabelLength);">
                                    <i id="toggleIcon@(i)" class="glyphicon glyphicon-minus"></i>
                                </a>
                                @child.GroupLabel @child.Last
                            </div>
                        }
                        else
                        {
                            if (@subLabelTabCount != 0)
                            {
                                subLabelTabCount--;
                                dashboardMarginClass = "dashboard_children_listitem_container_sublabel";
                            }
                            else
                            {
                                dashboardMarginClass = "dashboard_children_listitem_container_label";
                            }
                            <div id="dashboard_children_listitem@(i)" class="dashboard_children_listitem_container @dashboardMarginClass row" onclick="javascript:openContextPanelFromNode('@child.Name', '@child.SubKey');">
                                @*<div id="childrenListListItemStatusText" class="dashboard_children_listitem_status_text col-xs-3 col-lg-3 overflow">@statusMessage</div>*@
                                <div class="dashboard_children_listitem_location col-xs-5 col-lg-5 overflow">@child.Name</div>
                                <div class="dashboard_children_listitem_details col-xs-6 col-lg-6 overflow">@child.Last @child.Unit</div>
                            </div>
                        }
                    }
                }
                else
                {
                    <div id="dashboard_children_listitem@(i)" class="dashboard_children_listitem_container row" onclick="javascript:gotoChildrenNode('@dashboardUrl', @i);">
                        @*<div id="childrenListListItemStatusText" class="dashboard_children_listitem_status_text col-xs-3 col-lg-3 overflow">@statusMessage</div>*@
                        <div class="dashboard_children_listitem_location col-xs-5 col-lg-5 overflow">@child.City</div>
                        <div class="dashboard_children_listitem_details col-xs-6 col-lg-6 overflow">@child.Description</div>
                        <img class="dashboard-chevron-right" align="right" src="/Content/img/chevron_right.svg">
                    </div>
                }
            </div>
        }
    </div>
</div>

<script>
    var visible = [];

    $(document).ready(function () {
        jQuery('.scrollbar-inner').scrollbar();
        if ("@Model.TopNode.Key" != "topologyroot")
        {
             $("#backIcon").show();
             $("#headerText").addClass("dashboard_children_container_header_text_left_margin");
        }
        else
        {
            $("#backIcon").hide();
            $("#headerText").removeClass("dashboard_children_container_header_text_left_margin");
        }
    })

    function gotoChildrenNode(dashboardUrl,i) {
        window.location.href = dashboardUrl;
        selected(i+1);
    }

    function gotoParentNode() {
        var parentUrl = '@Url.Action("Index", "Dashboard", new { topNode = Model.TopNode.Parent})';
        window.location.href = parentUrl;
    }

    function expand(i, length) {
        for (var j = 0; j < length; j++) {
            var x = Number(i) + Number(j);

            $("#dashboard_children_listitem" + x).toggleClass("dashboard_children_group_display_none ");
            $("#toggleIcon" + x).toggleClass("glyphicon-plus glyphicon-minus");
        }
        //$("#toggleIcon" + i).toggleClass("glyphicon-plus glyphicon-minus");
    }

</script>